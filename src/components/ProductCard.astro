---
interface Product {
	id: string;
	name: string;
	price: number;
	description: string;
	images: string[];
	category: string;
	sizes: string[];
	inStock: boolean;
}

const { product } = Astro.props;

const formatPrice = (price: number) => {
	return new Intl.NumberFormat('it-IT', {
		style: 'currency',
		currency: 'EUR'
	}).format(price);
};
---

<article class="group relative bg-white border border-neutral-200 rounded-lg overflow-hidden hover:shadow-lg transition-shadow">
	<a href={`/prodotto/${product.id}`} class="block">
		<!-- Image -->
		<div class="relative aspect-[4/3] overflow-hidden bg-neutral-100">
			<img
				src={product.images[0] || '/placeholder-product.jpg'}
				alt={product.name}
				class="h-full w-full object-cover object-center group-hover:scale-105 transition-transform duration-300"
				loading="lazy"
			/>
			{!product.inStock && (
				<div class="absolute inset-0 bg-white/80 flex items-center justify-center">
					<span class="px-3 py-1 bg-neutral-900 text-white text-sm font-medium rounded">
						Esaurito
					</span>
				</div>
			)}
			{product.inStock && (
				<div class="absolute bottom-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity">
					<span class="px-2 py-1 bg-white/90 text-xs font-medium rounded shadow">
						Vedi dettagli
					</span>
				</div>
			)}
		</div>

		<!-- Content -->
		<div class="p-4 space-y-2">
			<div>
				<h3 class="font-semibold text-neutral-900 group-hover:text-neutral-600 transition-colors">
					{product.name}
				</h3>
				<p class="text-sm text-neutral-500 line-clamp-2">{product.description}</p>
			</div>
			<div class="flex items-center justify-between">
				<span class="text-lg font-semibold">{formatPrice(product.price)}</span>
				{product.inStock && (
					<button
						data-product-id={product.id}
						data-product-name={product.name}
						data-product-price={product.price}
						data-product-image={product.images[0] || '/placeholder-product.jpg'}
						data-product-sizes={product.sizes[0] || '40'}
						class="add-to-cart-btn px-3 py-1.5 bg-neutral-900 text-white text-sm font-medium rounded hover:bg-neutral-800 transition-colors"
					>
						Aggiungi
					</button>
				)}
			</div>
		</div>
	</a>
</article>

<script>
	document.querySelectorAll('.add-to-cart-btn').forEach((btn) => {
		btn.addEventListener('click', (e) => {
			e.preventDefault();
			e.stopPropagation();

			const button = e.currentTarget as HTMLElement;
			const item = {
				id: button.dataset.productId || '',
				name: button.dataset.productName || '',
				price: parseFloat(button.dataset.productPrice || '0'),
				image: button.dataset.productImage || '',
				size: button.dataset.productSizes || '40'
			};

			if ((window as any).addToCart) {
				(window as any).addToCart(item);
			}
		});
	});
</script>
